<!DOCTYPE html>
<html lang=en>

<head>
    <script src=https://cdn.jsdelivr.net/npm/dayjs@1.10.7/dayjs.min.js></script>
    <meta charset=UTF-8>
    <meta name=viewport content="width=device-width, initial-scale=1.0">
    <title>Optho-App</title>
    <link href=https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css rel=stylesheet
        integrity=sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH crossorigin=anonymous>
    <!-- <link href=https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css rel=stylesheet> -->
    <link rel=stylesheet href=/styles/tailstyle.css>
    <style>
        .modal-hidden {
            display: none;
        }
    </style>

<body class="bg-blue-200 h-screen overflow-hidden">
    <div class="wrapper h-screen w-full">
        <div class="cont md:p-4 h-screen w-full bg-blue-200 flex-col">
            <div class="title w-full h-fit text-blue-950 flex items-center gap-10">
                <div class="head flex items-center stroke-blue-950 w-fit space-x-2">
                    <svg xmlns=http://www.w3.org/2000/svg width=30 height=30 viewBox="0 0 24 24" fill=none
                        stroke-width=2 stroke-linecap=round stroke-linejoin=round
                        class="lucide lucide-users text-blue-500">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                        <circle cx=9 cy=7 r=4></circle>
                        <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    <h1 class="text-4xl font-semibold underline">
                        <%=det.name %> Details
                    </h1>
                </div>
                <div class="comms w-fit md:h-10 flex items-center">
                    <button id=send-email
                        class="md:py-2 md:h-10 md:px-6 md:mx-2 bg-white rounded-md flex items-center space-x-2 shadow-sm"
                        type=button>
                        <svg xmlns=http://www.w3.org/2000/svg aria-label=Gmail role=img viewBox="0 0 512 512" width=24
                            height=24>
                            <rect width=512 height=512 rx=15% fill=#ffffff />
                            <path d="M158 391v-142l-82-63V361q0 30 30 30" fill=#4285f4 />
                            <path d="M 154 248l102 77l102-77v-98l-102 77l-102-77" fill=#ea4335 />
                            <path d="M354 391v-142l82-63V361q0 30-30 30" fill=#34a853 />
                            <path d="M76 188l82 63v-98l-30-23c-27-21-52 0-52 26" fill=#c5221f />
                            <path d="M436 188l-82 63v-98l30-23c27-21 52 0 52 26" fill=#fbbc04 />
                        </svg>
                        <span>Email</span>
                    </button>
                    <button
                        class="md:h-10 md:py-2 md:px-6 md:mx-2 bg-white rounded-md flex items-center space-x-2 shadow-sm"
                        type=button>
                        <svg class=mr-1 width=24px height=24px viewBox="0 0 24 24" fill=none
                            xmlns=http://www.w3.org/2000/svg>
                            <path
                                d="M6 13C3.24 13 1 15.23 1 18C1 20.77 3.24 23 6 23C8.76 23 11 20.76 11 18C11 15.24 8.77 13 6 13ZM3.96 15.96H6C6.38 15.96 6.68 16.27 6.68 16.64C6.68 17.01 6.38 17.32 6 17.32H3.96C3.58 17.32 3.28 17.01 3.28 16.64C3.28 16.27 3.58 15.96 3.96 15.96ZM8.04 20.04H3.96C3.58 20.04 3.28 19.73 3.28 19.36C3.28 18.99 3.59 18.68 3.96 18.68H8.05C8.43 18.68 8.73 18.99 8.73 19.36C8.73 19.73 8.42 20.04 8.04 20.04Z"
                                fill=#292D32 />
                            <path
                                d="M17 3H7C4 3 2 4.5 2 8V11.14C2 11.87 2.75 12.33 3.42 12.04C4.52 11.56 5.77 11.38 7.08 11.59C9.7 12.02 11.84 14.09 12.37 16.69C12.52 17.45 12.54 18.19 12.44 18.9C12.36 19.49 12.84 20.01 13.43 20.01H17C20 20.01 22 18.51 22 15.01V8C22 4.5 20 3 17 3ZM17.47 8.59L14.34 11.09C13.68 11.62 12.84 11.88 12 11.88C11.16 11.88 10.31 11.62 9.66 11.09L6.53 8.59C6.21 8.33 6.16 7.85 6.41 7.53C6.67 7.21 7.14 7.15 7.46 7.41L10.59 9.91C11.35 10.52 12.64 10.52 13.4 9.91L16.53 7.41C16.85 7.15 17.33 7.2 17.58 7.53C17.84 7.85 17.79 8.33 17.47 8.59Z"
                                fill=#292D32 />
                        </svg>
                        SMS</button>
                    <button id=sendButton
                        class="md:h-10 md:py-2 md:px-6 md:mx-2 bg-white rounded-md flex items-center space-x-2 shadow-sm"
                        type=button>
                        <svg class=mr-1 width=24px height=24px viewBox="-1.5 0 259 259" version=1.1
                            xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink
                            preserveAspectRatio=xMidYMid>
                            <g>
                                <path
                                    d="M67.6631045,221.823373 L71.8484512,223.916047 C89.2873956,234.379413 108.819013,239.262318 128.350631,239.262318 L128.350631,239.262318 C189.735716,239.262318 239.959876,189.038158 239.959876,127.653073 C239.959876,98.3556467 228.101393,69.7557778 207.17466,48.8290445 C186.247927,27.9023111 158.345616,16.0438289 128.350631,16.0438289 C66.9655467,16.0438289 16.7413867,66.2679889 17.4389445,128.350631 C17.4389445,149.277365 23.7169645,169.50654 34.1803311,186.945485 L36.9705622,191.130831 L25.8096378,232.28674 L67.6631045,221.823373 Z"
                                    fill=#00E676>
                                </path>
                                <path
                                    d="M219.033142,37.66812 C195.316178,13.2535978 162.530962,0 129.048189,0 C57.8972956,0 0.697557778,57.8972956 1.39511556,128.350631 C1.39511556,150.67248 7.67313556,172.296771 18.1365022,191.828389 L0,258.096378 L67.6631045,240.657433 C86.4971645,251.1208 107.423898,256.003705 128.350631,256.003705 L128.350631,256.003705 C198.803967,256.003705 256.003705,198.106409 256.003705,127.653073 C256.003705,93.4727423 242.750107,61.3850845 219.033142,37.66812 Z M129.048189,234.379413 L129.048189,234.379413 C110.214129,234.379413 91.380069,229.496509 75.3362401,219.7307 L71.1508934,217.638027 L30.6925422,228.101393 L41.1559089,188.3406 L38.3656778,184.155253 C7.67313556,134.628651 22.3218489,69.05822 72.5460089,38.3656778 C122.770169,7.67313556 187.643042,22.3218489 218.335585,72.5460089 C249.028127,122.770169 234.379413,187.643042 184.155253,218.335585 C168.111425,228.798951 148.579807,234.379413 129.048189,234.379413 Z M190.433273,156.9505 L182.760138,153.462711 C182.760138,153.462711 171.599213,148.579807 164.623636,145.092018 C163.926078,145.092018 163.22852,144.39446 162.530962,144.39446 C160.438289,144.39446 159.043173,145.092018 157.648058,145.789576 L157.648058,145.789576 C157.648058,145.789576 156.9505,146.487133 147.184691,157.648058 C146.487133,159.043173 145.092018,159.740731 143.696902,159.740731 L142.999345,159.740731 C142.301787,159.740731 140.906671,159.043173 140.209113,158.345616 L136.721325,156.9505 L136.721325,156.9505 C129.048189,153.462711 122.072611,149.277365 116.492149,143.696902 C115.097033,142.301787 113.00436,140.906671 111.609245,139.511556 C106.72634,134.628651 101.843436,129.048189 98.3556467,122.770169 L97.658089,121.375053 C96.9605312,120.677496 96.9605312,119.979938 96.2629734,118.584822 C96.2629734,117.189707 96.2629734,115.794591 96.9605312,115.097033 C96.9605312,115.097033 99.7507623,111.609245 101.843436,109.516571 C103.238551,108.121456 103.936109,106.028782 105.331225,104.633667 C106.72634,102.540993 107.423898,99.7507623 106.72634,97.658089 C106.028782,94.1703001 97.658089,75.3362401 95.5654156,71.1508934 C94.1703001,69.05822 92.7751845,68.3606623 90.6825112,67.6631045 L88.5898378,67.6631045 C87.1947223,67.6631045 85.1020489,67.6631045 83.0093756,67.6631045 C81.6142601,67.6631045 80.2191445,68.3606623 78.8240289,68.3606623 L78.1264712,69.05822 C76.7313556,69.7557778 75.3362401,71.1508934 73.9411245,71.8484512 C72.5460089,73.2435667 71.8484512,74.6386823 70.4533356,76.0337978 C65.5704312,82.3118178 62.7802,89.9849534 62.7802,97.658089 L62.7802,97.658089 C62.7802,103.238551 64.1753156,108.819013 66.2679889,113.701918 L66.9655467,115.794591 C73.2435667,129.048189 81.6142601,140.906671 92.7751845,151.370038 L95.5654156,154.160269 C97.658089,156.252942 99.7507623,157.648058 101.145878,159.740731 C115.794591,172.296771 132.535978,181.365022 151.370038,186.247927 C153.462711,186.945485 156.252942,186.945485 158.345616,187.643042 L158.345616,187.643042 C160.438289,187.643042 163.22852,187.643042 165.321193,187.643042 C168.808982,187.643042 172.994329,186.247927 175.78456,184.852811 C177.877233,183.457696 179.272349,183.457696 180.667465,182.06258 L182.06258,180.667465 C183.457696,179.272349 184.852811,178.574791 186.247927,177.179676 C187.643042,175.78456 189.038158,174.389445 189.735716,172.994329 C191.130831,170.204098 191.828389,166.716309 192.525947,163.22852 C192.525947,161.833405 192.525947,159.740731 192.525947,158.345616 C192.525947,158.345616 191.828389,157.648058 190.433273,156.9505 Z"
                                    fill=#FFFFFF>
                                </path>
                            </g>
                        </svg>
                        Whatsapp</button>
                </div>
            </div>
            <div class="w-full md:h-[95%] md:pt-3 md:pb-4 flex justify-between">
                <div class="detcards md:min-w-[67%] h-full flex">
                    <div
                        class="hstry bg-white w-[33%] h-full rounded-lg shadow-xl md:p-4 md:mr-4 gap-0 font-medium text-blue-950 items-start">
                        <div
                            class="md:h-fit md:mt-2 font-semibold text-2xl flex items-center space-x-2 stroke-blue-950">
                            <svg width=24px height=24px viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg>
                                <title />
                                <g id=Complete>
                                    <g id=info-circle>
                                        <g>
                                            <circle cx=12 cy=12 data-name=--Circle fill=none id=_--Circle r=10
                                                stroke=#000000 stroke-linecap=round stroke-linejoin=round
                                                stroke-width=2 />
                                            <line fill=none stroke=#000000 stroke-linecap=round stroke-linejoin=round
                                                stroke-width=2 x1=12 x2=12 y1=12 y2=16 />
                                            <line fill=none stroke=#000000 stroke-linecap=round stroke-linejoin=round
                                                stroke-width=2 x1=12 x2=12 y1=8 y2=8 />
                                        </g>
                                    </g>
                                </g>
                            </svg>
                            <h3>Basic Info:</h3>
                        </div>
                        <div class="md:grid md:grid-rows-4">
                            <div class="grid grid-cols-2">
                                <div class>
                                    <p>Name:</p>
                                    <p class=text-xl>
                                        <%=det.name %>
                                    </p>
                                </div>
                                <div class>
                                    <p>No. of Visits:</p>
                                    <p class=text-xl>
                                        <%=logs.length %>
                                    </p>
                                </div>
                            </div>
                            <div class>
                                <p>Registration Number:</p>
                                <p class=text-xl>
                                    <%=det.reg %>
                                </p>
                            </div>
                            <div class>
                                <p>Contact Number:</p>
                                <div class="flex items-center">91+ <p class=text-xl>
                                        <%=det.contact %>
                                    </p>
                                </div>
                            </div>
                            <div class>
                                <p>Treatment Obtained:</p>
                                <ul class=text-lg>
                                    <% treatment.forEach(t=> { %>
                                        <li>
                                            &#8226; <%=t %>
                                        </li>
                                        <% }) %>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div
                        class="fnd bg-white w-[33%] grid grid-cols-3 text-center rounded-lg shadow-xl md:p-4 md:mr-4 text-blue-950 font-medium">
                        <div class="col-span-3 text-2xl font-semibold flex items-center space-x-2">
                            <svg width=24px height=24px viewBox="0 0 24 24" fill=none xmlns=http://www.w3.org/2000/svg>
                                <path
                                    d="M9.75 12C9.75 10.7574 10.7574 9.75 12 9.75C13.2426 9.75 14.25 10.7574 14.25 12C14.25 13.2426 13.2426 14.25 12 14.25C10.7574 14.25 9.75 13.2426 9.75 12Z"
                                    fill=#1C274C />
                                <path fill-rule=evenodd clip-rule=evenodd
                                    d="M2 12C2 13.6394 2.42496 14.1915 3.27489 15.2957C4.97196 17.5004 7.81811 20 12 20C16.1819 20 19.028 17.5004 20.7251 15.2957C21.575 14.1915 22 13.6394 22 12C22 10.3606 21.575 9.80853 20.7251 8.70433C19.028 6.49956 16.1819 4 12 4C7.81811 4 4.97196 6.49956 3.27489 8.70433C2.42496 9.80853 2 10.3606 2 12ZM12 8.25C9.92893 8.25 8.25 9.92893 8.25 12C8.25 14.0711 9.92893 15.75 12 15.75C14.0711 15.75 15.75 14.0711 15.75 12C15.75 9.92893 14.0711 8.25 12 8.25Z"
                                    fill=#1C274C />
                            </svg>
                            <span>Ocular Findings:</span>
                        </div>
                        <div>
                            <p class="border-y shadow-sm">LEFT</p>
                        </div>
                        <div class>
                            <p class="border-y shadow-sm">BCVA</p>
                        </div>
                        <div class>
                            <p class="border-y shadow-sm">RIGHT</p>
                        </div>
                        <div class>
                            <%=logs[0].bcval %>
                        </div>
                        <div class></div>
                        <div class>
                            <%=logs[0].bcvar %>
                        </div>
                        <div class>
                            <p class="border-y shadow-sm">LEFT</p>
                        </div>
                        <div class>
                            <p class="border-y shadow-sm">IOP</p>
                        </div>
                        <div class>
                            <p class="border-y shadow-sm">RIGHT</p>
                        </div>
                        <div class>
                            <%=logs[0].iopl %>
                        </div>
                        <div class></div>
                        <div class>
                            <%=logs[0].iopr %>
                        </div>
                        <div class>
                            <p class="border-y shadow-sm">LEFT</p>
                        </div>
                        <div class>
                            <p class="border-y shadow-sm">ETDRS</p>
                        </div>
                        <div class>
                            <p class="border-y shadow-sm">RIGHT</p>
                        </div>
                        <div class>
                            <%=logs[0].drl %>
                        </div>
                        <div class></div>
                        <div class>
                            <%=logs[0].drr %>
                        </div>
                        <div class>
                            <p class="border-y shadow-sm">LEFT</p>
                        </div>
                        <div class>
                            <p class="border-y shadow-sm">M. EDEMA</p>
                        </div>
                        <div class>
                            <p class="border-y shadow-sm">RIGHT</p>
                        </div>
                        <div class>
                            <%=logs[0].mel %>
                        </div>
                        <div class></div>
                        <div class>
                            <%=logs[0].mer %>
                        </div>
                        <div class>
                            <p class="border-y shadow-sm">LEFT</p>
                        </div>
                        <div class>
                            <p class="border-y shadow-sm">OCULAR</p>
                        </div>
                        <div class>
                            <p class="border-y shadow-sm">RIGHT</p>
                        </div>
                        <div class>
                            <%=logs[0].octl %>
                        </div>
                        <div class></div>
                        <div class>
                            <%=logs[0].octr%>
                        </div>
                    </div>
                    <div class="adv text-blue-950 font-medium bg-white w-[33%] rounded-lg shadow-xl md:p-4">
                        <div class="text-2xl font-semibold flex items-center space-x-2">
                            <svg width=24px height=24px viewBox="0 0 24 24" fill=none xmlns=http://www.w3.org/2000/svg>
                                <circle cx=12 cy=12 r=10 stroke=#1C274C stroke-width=1.5 />
                                <circle cx=12 cy=12 r=4 stroke=#1C274C stroke-width=1.5 />
                                <path opacity=0.5 d="M15 9L19 5" stroke=#1C274C stroke-width=1.5 />
                                <path opacity=0.5 d="M5 19L9 15" stroke=#1C274C stroke-width=1.5 />
                                <path opacity=0.5 d="M9 9L5 5" stroke=#1C274C stroke-width=1.5 />
                                <path opacity=0.5 d="M19 19L15 15" stroke=#1C274C stroke-width=1.5 />
                            </svg>
                            <span>Instructions:</span>
                        </div>
                        <div class=md:my-4>Advice:
                            <ul>
                                <% advice.forEach(adv=> { %>
                                    <li>&#8226; <%=adv %>
                                    </li>
                                    <% }) %>
                            </ul>
                        </div>
                        <div class=md:my-4>Follow Up:
                            <p class=text-xl>
                                <%=logs[0].fllwp %>
                            </p>
                        </div>
                        <div class=md:my-4>Notes:
                            null
                        </div>
                    </div>
                </div>
                <div class="logs text-blue-950 bg-white w-full md:h-full flex-col rounded-lg shadow-xl md:p-4 md:ml-4">
                    <div class="flex justify-between border-b">
                        <h5 class="flex items-center space-x-2 text-2xl font-semibold">
                            <svg class=mr-2 width=24px height=24px viewBox="0 0 24 24" fill=none
                                xmlns=http://www.w3.org/2000/svg>
                                <path opacity=0.5 d="M12 8V12L14.5 14.5" stroke=#1C274C stroke-width=1.5
                                    stroke-linecap=round stroke-linejoin=round />
                                <path
                                    d="M5.60414 5.60414L5.07381 5.07381V5.07381L5.60414 5.60414ZM4.33776 6.87052L3.58777 6.87429C3.58984 7.28556 3.92272 7.61844 4.33399 7.62051L4.33776 6.87052ZM6.87954 7.6333C7.29375 7.63539 7.63122 7.30129 7.6333 6.88708C7.63538 6.47287 7.30129 6.1354 6.88708 6.13332L6.87954 7.6333ZM5.07496 4.3212C5.07288 3.90699 4.73541 3.5729 4.3212 3.57498C3.90699 3.57706 3.5729 3.91453 3.57498 4.32874L5.07496 4.3212ZM3.82661 10.7849C3.88286 10.3745 3.59578 9.99627 3.1854 9.94002C2.77503 9.88377 2.39675 10.1708 2.3405 10.5812L3.82661 10.7849ZM18.8622 5.13777C15.042 1.31758 8.86873 1.27889 5.07381 5.07381L6.13447 6.13447C9.33358 2.93536 14.5571 2.95395 17.8016 6.19843L18.8622 5.13777ZM5.13777 18.8622C8.95796 22.6824 15.1313 22.7211 18.9262 18.9262L17.8655 17.8655C14.6664 21.0646 9.44291 21.0461 6.19843 17.8016L5.13777 18.8622ZM18.9262 18.9262C22.7211 15.1313 22.6824 8.95796 18.8622 5.13777L17.8016 6.19843C21.0461 9.44291 21.0646 14.6664 17.8655 17.8655L18.9262 18.9262ZM5.07381 5.07381L3.80743 6.34019L4.86809 7.40085L6.13447 6.13447L5.07381 5.07381ZM4.33399 7.62051L6.87954 7.6333L6.88708 6.13332L4.34153 6.12053L4.33399 7.62051ZM5.08775 6.86675L5.07496 4.3212L3.57498 4.32874L3.58777 6.87429L5.08775 6.86675ZM2.3405 10.5812C1.93907 13.5099 2.87392 16.5984 5.13777 18.8622L6.19843 17.8016C4.27785 15.881 3.48663 13.2652 3.82661 10.7849L2.3405 10.5812Z"
                                    fill=#1C274C />
                            </svg>
                            Visit History
                        </h5>
                        <div class="flex justify-around">
                            <button onclick="window.location.href='/export-to-excel/<%= logs[0].reg %>'"
                                class="flex items-center px-2 py-0 bg-transparent text-green-700 rounded-full border-1 border-green-700">
                                <svg xmlns=http://www.w3.org/2000/svg width=20 height=20 viewBox="0 0 24 24" fill=none
                                    stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round
                                    class="lucide lucide-file-spreadsheet">
                                    <path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"></path>
                                    <path d="M14 2v4a2 2 0 0 0 2 2h4"></path>
                                    <path d="M8 13h2"></path>
                                    <path d="M14 13h2"></path>
                                    <path d="M8 17h2"></path>
                                    <path d="M14 17h2"></path>
                                </svg>
                            </button>
                            <button id="openModal" type=submit><svg width=40px height=40px viewBox="0 0 24 24"
                                    fill=none xmlns=http://www.w3.org/2000/svg>
                                    <path fill-rule=evenodd clip-rule=evenodd
                                        d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22ZM12.75 9C12.75 8.58579 12.4142 8.25 12 8.25C11.5858 8.25 11.25 8.58579 11.25 9L11.25 11.25H9C8.58579 11.25 8.25 11.5858 8.25 12C8.25 12.4142 8.58579 12.75 9 12.75H11.25V15C11.25 15.4142 11.5858 15.75 12 15.75C12.4142 15.75 12.75 15.4142 12.75 15L12.75 12.75H15C15.4142 12.75 15.75 12.4142 15.75 12C15.75 11.5858 15.4142 11.25 15 11.25H12.75V9Z"
                                        fill=#1C274C />
                                </svg>
                            </button>
                        </div>
                    </div>


                    <div
                        class="w-full max-h-[500px] overflow-y-auto scrollbar-hide md:py-1 bg-gray-50 overflow-x-visible">
                        <!-- Visit Cards -->
                        <% for (let i = 0; i < logs.length; i++) { %>
                            <div
                                class="md:p-2 border rounded-lg shadow-md md:mt-3 bg-white transform transition-transform duration-300 hover:translate-y-[-10px] hover:shadow-lg">
                                <p class="font-semibold text-lg text-blue-800">
                                    <% 
                                        // Create a Date object from the created_at string 
                                        const createdAt = new Date(logs[i].created_at); 
                                        
                                        // Format the date manually
                                        const formattedDate = createdAt.toLocaleString('en-US', { 
                                                        day: '2-digit',   // Two-digit day
                                                        month: '2-digit', // Two-digit month
                                                        year: 'numeric',  // Full year (e.g., 2024)
                                                        hour: '2-digit',  // Two-digit hour
                                                        minute: '2-digit', // Two-digit minute
                                                        hour12: true      // 12-hour format with AM/PM
                                                    });
                                    %>
                                    Visit #<%= ((logs.length) - i) %> - <%= formattedDate %>
                                </p>
                                <p class="text-gray-600">Click to load Details</p>
                            </div>
                        <% } %>



                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
        <div class="bg-white rounded-lg shadow-lg max-w-7xl p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-4">New Entry</h2>
                <button id="closeModal" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>

            <form action="/updatePat/<%= logs[0].reg %>" method="POST">
                <div class=" grid grid-cols-4 2/3 gap-2 mb-6">

                    <div class="space-y-2 px-2 full">
                         <div>
                        <label class="block text-gray-700 text-sm font-semibold mb-2" for="OHA_count">Registration Number</label>
                        <input
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"
                            type="text" id="reg" name="reg" placeholder="Registration Number" value="<%= logs[0].reg %>">
                    </div>
                        <div class="grid gap-4 ">
                           <div class="h-full grid grid-cols-2 gap-2"> 
                            <div>
                                <label class="block text-gray-700 text-sm font-semibold mb-2" for="dtype">Type of
                                    Diabetes</label>
                                <select
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"
                                    id="dtype" name="dtype">
                                    <option value="<%=  logs[0].dtype %>" checked><%=  logs[0].dtype %></option>
                                    <option value="type1">Type 1</option>
                                    <option value="type2">Type 2</option>
                                    <option value="mody">MODY</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm font-semibold mb-2"
                                    for="ddur">Duration</label>
                                <select
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"
                                    name="ddur" id="ddur">
                                    <option value="<%=  logs[0].ddur %>" checked>
                                        <%=  logs[0].ddur %></option>
                                    <option value="Newly diagnosed(<1 year)">
                                        < 1 year</option>
                                    <option value="Less than 5 years">
                                        < 5 years</option>
                                    <option value="Between 5 years to 10 years">5-10 years</option>
                                    <option value="More than 10 years">> 10 years</option>
                                </select>
                            </div>
                        </div>
                            <div>
                                <label class="block text-gray-700 text-sm font-semibold mb-2">Insulin</label>
                                <div class="flex gap-4">
                                    <label class="inline-flex items-center">
                                        <input type="radio" class="text-blue-600 focus:ring-blue-500 h-4 w-4"
                                            name="insulin" value="yes_insulin" checked>
                                        <span class="ml-2 text-sm text-gray-700">Yes</span>
                                    </label>
                                    <label class="inline-flex items-center">
                                        <input type="radio" class="text-blue-600 focus:ring-blue-500 h-4 w-4"
                                            name="insulin" value="no_insulin">
                                        <span class="ml-2 text-sm text-gray-700">No</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div>
                            <div class="grid gap-4">
                                <div>
                                    <label class="block text-gray-700 text-sm font-semibold mb-2" for="OHA_count">No. of
                                        BHA</label>
                                    <input
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"
                                        type="text" id="OHA_count" name="OHA_count" placeholder="No. of BHA">
                                </div>
                                <div>
                                    <label class="block text-gray-700 text-sm font-semibold mb-2" for="HBA1c">HbA1c
                                        (%)</label>
                                    <input
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"
                                        type="text" id="HBA1c" name="HBA1c" placeholder="HBA1c">
                                </div>
                            </div>

                        </div>
                    </div>




                    <div class="space-y-2 px-2 max-w-3xl col-span-2">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-gray-700 text-sm font-semibold mb-2" for="bcval">BCVA Left
                                    Eye:</label>
                                <select
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    id="bcval" name="bcval">
                                    <option value="6/6">6/6</option>
                                    <option value="6/9">6/9</option>
                                    <option value="6/12">6/12</option>
                                    <option value="6/18">6/18</option>
                                    <option value="6/24">6/24</option>
                                    <option value="6/36">6/36</option>
                                    <option value="6/60">6/60</option>
                                    <option value="5/60">5/60</option>
                                    <option value="4/60">4/60</option>
                                    <option value="3/60">3/60</option>
                                    <option value="2/60">2/60</option>
                                    <option value="1/60">1/60</option>
                                    <option value="PL+">PL+</option>
                                    <option value="PL-">PL-</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm font-semibold mb-2" for="bcvar">BVCA Right
                                    Eye:</label>
                                <select
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    id="bcvar" name="bcvar">
                                    <option value="6/6">6/6</option>
                                    <option value="6/9">6/9</option>
                                    <option value="6/12">6/12</option>
                                    <option value="6/18">6/18</option>
                                    <option value="6/24">6/24</option>
                                    <option value="6/36">6/36</option>
                                    <option value="6/60">6/60</option>
                                    <option value="5/60">5/60</option>
                                    <option value="4/60">4/60</option>
                                    <option value="3/60">3/60</option>
                                    <option value="2/60">2/60</option>
                                    <option value="1/60">1/60</option>
                                    <option value="PL+">PL+</option>
                                    <option value="PL-">PL-</option>
                                </select>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-gray-700 text-sm font-semibold mb-2" for="iopl">IOP Left Eye
                                    (mmHg):</label>
                                <input
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    type="text" id="iopl" name="iopl" placeholder="Enter IOP" />
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm font-semibold mb-2" for="iopr">IOP Right Eye
                                    (mmHg):</label>
                                <input
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    type="text" id="iopr" name="iopr" placeholder="Enter IOP" />
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-gray-700 text-sm font-semibold mb-2" for="drl">DR Left
                                    Eye</label>
                                <select
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    id="drl" name="drl">
                                    <option value="No DR at present">No DR at present</option>
                                    <option value="Mild NPDR">Mild NPDR</option>
                                    <option value="Moderate NPDR">Moderate NPDR</option>
                                    <option value="Severe NPDR">Severe NPDR</option>
                                    <option value="Very severe NPDR">Very severe NPDR</option>
                                    <option value="PDR without HRC">PDR without HRC</option>
                                    <option value="PDR with HRC">PDR with HRC</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-gray-700 text-sm font-semibold mb-2" for="drr">DR Right
                                    Eye</label>
                                <select
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    id="drr" name="drr">
                                    <option value="No DR at present">No DR at present</option>
                                    <option value="Mild NPDR">Mild NPDR</option>
                                    <option value="Moderate NPDR">Moderate NPDR</option>
                                    <option value="Severe NPDR">Severe NPDR</option>
                                    <option value="Very severe NPDR">Very severe NPDR</option>
                                    <option value="PDR without HRC">PDR without HRC</option>
                                    <option value="PDR with HRC">PDR with HRC</option>
                                </select>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-gray-700 text-sm font-semibold mb-2" for="mel">ME Left
                                    Eye</label>
                                <select
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    id="mel" name="mel">
                                    <option value="Center involving">Center involving</option>
                                    <option value="Non Center involving">
                                        Non Center involving
                                    </option>
                                    <option value="Other">Other (like cataract)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm font-semibold mb-2" for="mer">ME Right
                                    Eye</label>
                                <select
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    id="mer" name="mer">
                                    <option value="Center involving">Center involving</option>
                                    <option value="Non Center involving">
                                        Non Center involving
                                    </option>
                                    <option value="Other">Other (like cataract)</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-gray-700 text-sm font-semibold mb-2" for="octl">OCT Left
                                    Eye:</label>
                                <input
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    type="text" id="octl" name="octl" placeholder="Enter OCT value" />
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm font-semibold mb-2" for="octr">OCT Right
                                    Eye:</label>
                                <input
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    type="text" id="octr" name="octr" placeholder="Enter OCT value" />
                            </div>
                        </div>
                    </div>


                    <div class="px-2">


                        <div class="space-y-2">
                            <div class="space-y-2">
                                <label class="block text-gray-700 text-sm font-semibold mb-2">Treatment Obtained</label>
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox"
                                            class="h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                                            id="none" name="treatment[]" value="none" />
                                        <span class="ml-2 text-sm text-gray-700">None</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox"
                                            class="h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                                            id="Intravitreal injection" name="treatment[]"
                                            value="Intravitreal injection" />
                                        <span class="ml-2 text-sm text-gray-700">Intravitreal Injection</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox"
                                            class="h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                                            id="PRP" name="treatment[]" value="PRP" />
                                        <span class="ml-2 text-sm text-gray-700">PRP</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox"
                                            class="h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                                            id="Retinal surgery" name="treatment[]" value="Retinal surgery" />
                                        <span class="ml-2 text-sm text-gray-700">Retinal Surgery</span>
                                    </label>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <label class="block text-gray-700 text-sm font-semibold mb-2">Treatment Advice</label>
                                <div class="space-y-1.5">
                                    <label class="flex items-center">
                                        <input type="checkbox"
                                            class="h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                                            name="advice" value="Follow-up, same treatment" />
                                        <span class="ml-2 text-sm text-gray-700">Continue same treatment</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox"
                                            class="h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                                            name="advice" value="Follow up, start on new medications advised" />
                                        <span class="ml-2 text-sm text-gray-700">Start new medications</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox"
                                            class="h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                                            name="advice" value="PRP" />
                                        <span class="ml-2 text-sm text-gray-700">PRP</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox"
                                            class="h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                                            name="advice" value="Intravitreal injection" />
                                        <span class="ml-2 text-sm text-gray-700">Intravitreal injection</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox"
                                            class="h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                                            name="advice" value="Vitreoretinal Surgery" />
                                        <span class="ml-2 text-sm text-gray-700">Vitreoretinal Surgery</span>
                                    </label>
                                </div>
                            </div>

                            <div>
                                <label class="block text-gray-700 text-sm font-semibold mb-2" for="fllwp">Follow-up
                                    Date</label>
                                <input
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    type="date" id="fllwp" name="fllwp" />
                            </div>




                            <div class="flex justify-end space-x-4 mt-6">
                                <button type="button"
                                    class="px-4 py-2 bg-gray-200 rounded-md hover:bg-gray-300 text-gray-700"
                                    id="cancelModal">Cancel</button>
                                <button type="submit"
                                    class="px-4 py-2 bg-blue-600 rounded-md hover:bg-blue-700 text-white font-medium">New
                                    Entry</button>
                            </div>
            </form>
        </div>
    </div>
    <script>
        function closeModal() { document.querySelector('.fixed').remove(); }
    </script>
    <script>
        document.getElementById('send-email').addEventListener('click', async () => { const templateData = { name: "<%= det.name %>", message: { greet: "This message is Dynamically generated!.", drr: "<%= det.ddr %>", drl: "<%= det.drl %>", mer: "<%= det.mer %>", mel: "<%= det.mel %>", octr: "<%= det.octr %>", octl: "<%= det.octl %>", }, }; try { const response = await fetch('http://localhost:3000/send-email', { method: 'POST', headers: { 'Content-Type': 'application/json', }, body: JSON.stringify({ recipient: 'zeusgaming2735@gmail.com', subject: 'Eye Report', templateData, }), }); const result = await response.json(); if (result.success) { alert('Email sent successfully!'); } else { alert('Failed to send email: ' + result.message); } } catch (error) { console.error('Error:', error); alert('Error sending email. Check console for details.'); } });
    </script>

    <script src=https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js></script>
    <script type=module>
    document.getElementById('sendButton').addEventListener('click', async () => {
        try {
            const phoneNumber = '8356074065'; // Replace with the phone number
            const message = 'Hello, this is a test message!';
    
            const response = await axios.post('http://localhost:3000/whatsapp-message', {
                phoneNumber,
                message,
            });
    
            console.log('Response:', response); // Log the response for debugging
    
            if (response.data.success) {
                alert('Message sent successfully!');
            } else {
                alert('Failed to send message');
            }
        } catch (error) {
            console.error('Error sending message:', error); // Log the error
            alert(`Error sending message: ${error.message || error}`);
        }
    });
  </script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
    const openModalButton = document.getElementById('openModal');
    const closeModalButton = document.getElementById('closeModal');
    const cancelModalButton = document.getElementById('cancelModal');
    const modal = document.getElementById('modal');
    const modalContent = document.getElementById('modalContent');

    // Function to open modal
    openModalButton.addEventListener('click', () => {
        modal.classList.remove('hidden');
    });

    // Function to close modal
    const closeModal = () => {
        modal.classList.add('hidden');
    };

    closeModalButton.addEventListener('click', closeModal);
    cancelModalButton.addEventListener('click', closeModal);

    // Optional: Close the modal when clicking outside of the modal content
    window.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.classList.add('hidden');
        }
    });
});

    </script>
</body>

</html>